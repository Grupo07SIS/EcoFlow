<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="../assets/Logo.png" />
    <title>Ecoflow | Participar Evento</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link rel="stylesheet" href="../../css/colaboradorParticiparStyle/dados_gerais.css">
    <link rel="stylesheet" href="../../css/atracao.css">
    <link rel="stylesheet" href="../../css/menu.css">
</head>

<body>
    <div class="titulo_pagina">
        <h4>PARTICIPAR EVENTO</h4>
    </div>
    <div class="main_info">
        <div class="dados_gerais">
            <h5>DADOS DA EQUIPE</h5>
        </div>

        <div class="dados_produtos">
            <div>
                <h5>EQUIPE</h5>
                <div class="adicionar_produto">
                    <h6>Adicionar pessoas na equipe</h6>
                    <button id="addProdutoCard"><i class="bi bi-plus-circle-fill adicionar_produto"></i></button>
                </div>
                <div id="productMessage" class="alert alert-warning" role="alert" style="display: none;">
                    VocÃª precisa adicionar membros.
                </div>
            </div>

            <div id="productContainer">
            </div>
        </div>
    </div>

    <div class="proximo-voltar">
        <button type="button" class="btn btn-outline-secondary" onclick="voltar()">
            Voltar
        </button>
        <button type="button" class="btn btn-secondary" onclick="salvarDadosPag2()">
            Proximo
        </button>
    </div>

    <div class="menu">
        <a href="index-colaborador.html" class="opcoes">
            <img src="../../assets/Vector 3 (1).png" alt="">
            <p>Inicio</p>
        </a>
        <a href="eventos-colaborador.html" class="opcoes">
            <img src="../../assets/Calendar icon.png" alt="">
            <p>Eventos</p>
        </a>
        <a href="perfil-colaborador.html" class="opcoes">
            <img src="../../assets/Group 3.png" alt="">
            <p>Perfil</p>
        </a>
        <a href="login.html" class="opcoes">
            <img src="../../assets/Logout.png" alt="Sair">
            <p>Sair</p>
        </a>
    </div>
</body>

<script>

function voltar() {
    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get('id');
    
    window.location.href = `dados_gerais-colaborador.html?id=${eventId}`;
}
    // Function to toggle the visibility of ingredients and rotate the icon
function toggleIngredients(element) {
    const ingredientesDiv = element.parentNode.nextElementSibling.nextElementSibling;
    const icon = element.querySelector('i');
    if (ingredientesDiv.style.display === "none" || ingredientesDiv.style.display === "") {
        ingredientesDiv.style.display = "block";
        icon.style.transform = "rotate(180deg)";
    } else {
        ingredientesDiv.style.display = "none";
        icon.style.transform = "rotate(0deg)";
    }
}

// Function to add a new team member card
function addEquipeCard() {
    const container = document.getElementById('productContainer');
    const productMessage = document.getElementById('productMessage');
    productMessage.style.display = 'none';

    const newCard = document.createElement('div');
    newCard.classList.add('info_card');

    newCard.innerHTML = `
        <div class="info_form">
            <div class="drop_down">
                <label>Nome da Pessoa:</label>
                <div class="expandir_div" onclick="toggleIngredients(this)">
                    Expandir
                    <i class="bi bi-chevron-down"></i>
                </div>
            </div>
            <input type="text" class="team-name">
            <div class="ingredientes" style="display: none;">
                <span>Telefone:</span>
                <input type="text" class="team-phone">
            
                <span>E-mail:</span>
                <input type="text" class="team-email">
            </div>
            <div class="btn_delete">
                <button onclick="removeEquipeCard(this)">
                    Excluir Membro
                    <i class="bi bi-trash"></i>
                </button>
            </div>
        </div>
    `;

    container.appendChild(newCard);
}

// Function to remove a team member card
function removeEquipeCard(button) {
    const container = document.getElementById('productContainer');
    button.closest('.info_card').remove();

    if (container.children.length === 0) {
        document.getElementById('productMessage').style.display = 'block';
    }
}

// Add event listener to the add team member button
document.getElementById('addProdutoCard').addEventListener('click', addEquipeCard);

// Show the message if no team members are added on page load
window.onload = function () {
    const container = document.getElementById('productContainer');
    if (container.children.length === 0) {
        document.getElementById('productMessage').style.display = 'block';
    }
};

async function salvarDadosPag2() {
    const urlParams = new URLSearchParams(window.location.search);
    const eventId = urlParams.get('id');
    const teamContainer = document.getElementById('productContainer');
    const teamMembers = [];

    const teamCards = teamContainer.getElementsByClassName('info_card');
    if (teamCards.length === 0) {
        document.getElementById('productMessage').style.display = 'block';
        return;
    }

    // Collect team member details from each card
    for (let card of teamCards) {
        const memberName = card.querySelector('.team-name').value;
        const memberPhone = card.querySelector('.team-phone').value;
        const memberEmail = card.querySelector('.team-email').value;

        if (memberName.trim() === "") {
            alert("Por favor, preencha o nome do membro da equipe.");
            return;
        }

        teamMembers.push({
            nome: memberName,
            telefone: memberPhone,
            email: memberEmail
        });
    }

    // Save team members to sessionStorage instead of sending to the backend
    sessionStorage.setItem('equipe', JSON.stringify(teamMembers));

    // Redirect to the next page (choose a stand)
    window.location.href = `stand-colaborador.html?id=${eventId}`;
}

// On page load, restore the saved team members from sessionStorage
window.onload = function () {
    const container = document.getElementById('productContainer');
    const savedTeam = JSON.parse(sessionStorage.getItem('equipe') || '[]');

    if (savedTeam.length > 0) {
        savedTeam.forEach(member => {
            const newCard = document.createElement('div');
            newCard.classList.add('info_card');

            newCard.innerHTML = `
                <div class="info_form">
                    <div class="drop_down">
                        <label>Nome da Pessoa:</label>
                        <div class="expandir_div" onclick="toggleIngredients(this)">
                            Expandir
                            <i class="bi bi-chevron-down"></i>
                        </div>
                    </div>
                    <input type="text" class="team-name" value="${member.nome}">
                    <div class="ingredientes" style="display: none;">
                        <span>Telefone:</span>
                        <input type="text" class="team-phone" value="${member.telefone}">
                    
                        <span>E-mail:</span>
                        <input type="text" class="team-email" value="${member.email}">
                    </div>
                    <div class="btn_delete">
                        <button onclick="removeEquipeCard(this)">
                            Excluir Membro
                            <i class="bi bi-trash"></i>
                        </button>
                    </div>
                </div>
            `;

            container.appendChild(newCard);
        });
    } else {
        document.getElementById('productMessage').style.display = 'block';
    }
};



</script>

</html>
